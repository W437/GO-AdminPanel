<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

/**
 * EXAMPLE CONSOLIDATION: Users Table
 *
 * This shows how to consolidate 13 separate migrations into one.
 * Original migrations:
 * - 2014_10_12_000000_create_users_table.php
 * - 2021_06_27_140224_add_interest_column_to_users_table.php
 * - 2021_06_30_084854_add_cm_firebase_token_column_to_users_table.php
 * - 2021_08_08_203108_add_status_column_to_users_table.php
 * - 2021_08_14_180044_add_order_count_column_to_users_table.php
 * - 2022_01_05_133920_add_sosial_data_column_to_users_table.php
 * - 2022_02_07_162330_add_zone_id_column_to_users_table.php
 * - 2022_04_09_161150_add_wallet_point_columns_to_users_table.php
 * - 2022_05_17_153333_add_ref_code_to_users_table.php
 * - 2023_02_08_113749_add_ref_by_col_to_users_table.php
 * - 2023_03_18_144849_add_temp_token_col_in_users_table.php
 * - 2023_11_21_132325_add_current_language_key_col_to_users_table.php
 * - 2024_09_30_154821_add_is_email_verified_col_to_users_table.php
 * - 2025_10_03_123607_add_emoji_profile_fields_to_users_table.php
 */
return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            // Original columns from create_users_table (2014)
            $table->id();
            $table->string('f_name', 100)->nullable();
            $table->string('l_name', 100)->nullable();
            $table->string('phone')->unique()->nullable();
            $table->string('email', 100)->nullable();
            $table->string('image', 100)->nullable();
            $table->boolean('is_phone_verified')->default(0);
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password', 100)->nullable();
            $table->rememberToken();

            // From add_interest_column (2021_06_27)
            $table->string('interest')->nullable();

            // From add_cm_firebase_token (2021_06_30)
            $table->string('cm_firebase_token')->nullable();

            // From add_status_column (2021_08_08)
            $table->boolean('status')->default(1);

            // From add_order_count_column (2021_08_14)
            $table->integer('order_count')->default(0);

            // From add_sosial_data_column (2022_01_05)
            $table->string('login_medium')->nullable();
            $table->string('social_id')->nullable();

            // From add_zone_id_column (2022_02_07)
            $table->foreignId('zone_id')->nullable()->constrained();

            // From add_wallet_point_columns (2022_04_09)
            $table->decimal('wallet_balance', 24, 3)->default(0);
            $table->decimal('loyalty_point', 24, 3)->default(0);

            // From add_ref_code (2022_05_17)
            $table->string('ref_code')->unique()->nullable();

            // From add_ref_by_col (2023_02_08)
            $table->unsignedBigInteger('ref_by')->nullable();

            // From add_temp_token_col (2023_03_18)
            $table->string('temp_token')->nullable();

            // From add_current_language_key_col (2023_11_21)
            $table->string('current_language_key')->nullable()->default('en');

            // From add_is_email_verified_col (2024_09_30)
            $table->boolean('is_email_verified')->default(0);

            // From add_emoji_profile_fields (2025_10_03)
            $table->string('profile_emoji', 10)->nullable()->default('ðŸ˜Š');
            $table->string('profile_bg_color', 7)->nullable()->default('#FFFFFF');

            // Timestamps
            $table->timestamps();

            // Indexes for performance
            $table->index('phone');
            $table->index('email');
            $table->index('zone_id');
            $table->index('status');
            $table->index('created_at');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
    }
};